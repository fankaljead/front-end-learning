# 第11章 高级特效

## 11.1 CSS Shapes

网页布局基本上都是由矩形构成的，因此 HTML 元素天生具有方形的特性。

CSS Shapes 是一个新标准，旨在让 Web  设计能使用各种形状。形状元素不仅会影响界面的外观，还会影响页面的内容流。。

- **细说形状**

    CSS Shapes 包含两组新属性，一组用于设置影响盒子中内容的形状，另一组用于设置影响元素 **周边** 内容流的形状

    如下图，我们看到一个被设置为圆形的形状，其中左边的图形展示了外部形状如何影响周边的内容，右边的图形展示了圆形中的内容如何受到内部形状的影响：

    ![image-20211011101853316](https://i.loli.net/2021/10/11/a3JfONBwhM8v9qk.png)

    这两种形状分别由不同级别的 CSS Shapes 规范定义。其中 `shape-outside` 属性是唯一相对成熟的。`shape-inside` 还未有浏览器实现

    `shape-outside` 属性只能应用给浮动元素。这个属性不改变元素自身的外观，只会通过设置形状影响其外部内容流。

    我们在 ”Moon“ 部分，通过设置 `shape-outside: circle();` ，实现了文本流环绕月亮图片的效果：

    ```css
    .fig-moon {
        float: right;
        max-width: 40%;
        shape-outside: circle();
    }
    ```

    ![image-20211011104258819](https://i.loli.net/2021/10/11/RYdhwQH5sKVvlmA.png)

    `shape-outside()` 影响图片：图片文件本身的背景是黑色的，如果把这一区块的背景色改成其它颜色，会更清楚。

    ![image-20211011104730742](https://i.loli.net/2021/10/11/4tOSrusk7p1R8V5.png)

    图片本身是方形的，但文本流环绕其中的圆形。在不支持 CSS 形状的浏览器中，文本会像往常一样环绕矩形。

    1. **形状函数**

        - `circle()` 圆形

        - `ellipse()` 椭圆形 接受两个半径值和一个位置值

            ```css
            .shape-ellipse {
                shape-outside: ellipse(150px 40px at 50% 24%);
            }
            ```

            

        - `polygon()` 多边形 接受一系列坐标对，用于在盒子表面指定多个点，坐标相对于盒子的左上角，最终把各个点连接起来就是要创建的形状

            - 创建多边形最简单的一种方式是使用 CSS Shapes Editor  插件

            - 多边形中的每个点坐标以百分比表示，这样可以保证最大的灵活度

        - `inset()` 嵌入在盒子边界内的矩形，也可以指定圆角 传入一组长度值，分别表示上、右、下、左边的距离

        

    2. **形状图片**

        基于复杂的图片创建多边形会非常麻烦。可以直接在图片的源文件上基于透明度来创建形状。比如，可以按照预期的形状新创建一张图片。例如土星的图片已经是带透明度的 PNG 格式了，可以直接通过它来生成形状。通过把 `shape-outside` 的指向改图片的 `url()` 函数：

        ```css
        .fig-planet {
            float: right;
            max-width: 65%;
            shape-outside: url(img/saturn.png);
        }
        ```

        ![image-20211011110249261](https://i.loli.net/2021/10/11/L5aeDBbSzqCRPcU.png)

        默认情况下，形状轮廓会沿着图片完全透明区域的边缘生成，但这个值可以通过 `shape-image-threshold` 属性来修改。默认值是 `0.0` （完全透明），而较大的值（最大为 `1.0` ）意味着较高的不透明度也可以用来生成形状边界 。例如，修改土星图片的不透明度阈值为 `0.9` ，则半透明的土星环不再被包含在形状内，结果文本覆盖其上：

        ```css
        .fig-planet {
            float: right;
            max-width: 65%;
            shape-outside: url(img/saturn.png);
        	shape
        }
        ```

        

    3. **形状盒子与边距**

        除了使用形状函数或图片，还可以使用元素的参照盒子来生成形状。虽然元素盒子是方形的，但形状也能依照圆角生成。

    4. **浏览器对 CSS Shapes  的支持情况**

## 11.2 剪切与蒙版

CSS 形状虽然可以影响周围文本流，却不允许修改元素自身的外观。添加圆角边框值是视觉上改变元素形状的一种方式。实际上，通过把元素的部分区域变透明，是可以影响元素自身形状的。

- **剪切 clipping** 使用路径形状定义硬边界，可以基于该边界完全切换元素的可见性。

- **蒙版 masking** 用于将元素的某些区域设置为更透明或更不透明。

- 剪切会影响对象的响应区域，而蒙版不会。

- 比如，要触发悬停，鼠标必须移动到剪切后元素的可见区域，而对于加了蒙版的元素，无论鼠标下面的区域是否可见，只要位于该元素上，都会激活 `:hover` 状态

### 11.2.1 剪切

剪切最早在 CSS 2.1 通过 `clip` 属性引入，但这个属性只能应用给绝对定位的元素，而且只能把这些元素剪切为矩形（使用 `rect()`  函数）

新的 `clip-path` 可以使用CSS 形状中的基本形状函数定义如何剪切元素，还能使用 SVG 文档剪切元素，只要通过 URL 引用一个 `<clipPath>` 元素即可。
